YUI.add("flickr-groups-admin-acceptPhoto-updater",function(o,e){"use strict";o.namespace("ModelUpdaters")["flickr-groups-admin-acceptPhoto"]={run:function(t,p){var r=this,s=this._processParams(t),l=t.registryName||"group-pool-models",u={apiResponse:p.callAPI("flickr.groups.admin.acceptPhoto",s),groupPoolModel:p.getModel(l,t.groupID),photoModel:p.getModel("photo-models",t.photoID),photoGroupsModelRegistry:p.getModelRegistry("photo-groups-models"),photoContextsModelRegistry:p.getModelRegistry("photo-contexts-models"),pendingModelRegistry:p.getModelRegistry("photo-group-pending-models"),pendingsModelRegistry:p.getModelRegistry("photo-group-pendings-models")};return t.unfilteredGroupId=s.group_id,"group-pool-models"!==l&&(u.unfilteredGroupPoolModel=p.getModel("group-pool-models",t.unfilteredGroupId)),new o.FlickrPromise(u).then(function(o){return r._processResponse(o,t)},o.FetcherErrorLogger(e))},_processParams:function(e){return{photo_id:e.photoID,group_id:o.Models["group-pool-models"].extractGroupFromCompoundId(e.groupID)}},_processResponse:function(o,e){var t,p=o.apiResponse,r=o.groupPoolModel,s=o.photoModel,l=o.photoGroupsModelRegistry,u=o.photoContextsModelRegistry,d=o.unfilteredGroupPoolModel,g=o.pendingModelRegistry,i=o.pendingsModelRegistry;if("ok"===p.stat)return r&&!r.hasPhoto(s.getValue("id"))&&(r.addPhotoLocal(s),r.getValue("group").setValue("poolCount",r.getValue("group").getValue("poolCount")+1)),d&&d.hasPhoto(s.getValue("id"))&&d.addPhotoLocal(s),l.exists(e.photoID)&&!l.getValue(e.photoID,"groups").getFromListByID(e.unfilteredGroupId)&&(l.getValue(e.photoID,"groups").unshift(r),l.setValue(e.photoID,"total",l.getValue(e.photoID,"total")+1)),u.exists(e.photoID)&&!u.getValue(e.photoID,"contexts").getFromListByID(e.unfilteredGroupId)&&(u.setValue(e.photoID,"totalGroups",u.getValue(e.photoID,"totalGroups")+1),u.getValue(e.photoID,"contexts").push(r)),t=[e.photoID,e.unfilteredGroupId].join("-"),i.exists(e.photoID)&&i.getValue(e.photoID,"pendings").getFromListByID(t)&&(i.setValue(e.photoID,"total",i.getValue(e.photoID,"total")-1),i.getValue(e.photoID,"pendings").removeFromList(t)),g.remove(t),r}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-contributor-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,attributes:{nsid:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},dateJoined:{validator:function(e){return t.AttributeHelpers.validateDate(e)},setter:function(e){return t.AttributeHelpers.coerceDate(e)},serialize:function(t){return t.format("X")},deserialize:function(e){return t.moment(e,"X")}},groupDiscussionCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},groupPhotoCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultValue:0},pathAlias:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},rank:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)}},realname:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},username:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoId:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},latestPhotoTitle:{validator:function(e,r){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)}},buddyicon:{},latestPhotoUrl:{readOnly:!0,derivedBy:["contributorUrl","latestPhotoId"],getter:function(t,e){return!!this.getValue(e,"latestPhotoId")&&this.getValue(e,"contributorUrl")+this.getValue(e,"latestPhotoId")+"/"}},displayname:{readOnly:!0,derivedBy:["username"],getter:function(t,e){return this.getValue(e,"username")}},contributorUrl:{readOnly:!0,derivedBy:["id","pathAlias"],getter:function(t,e){return"/photos/"+(this.getValue(e,"pathAlias")||this.getValue(e,"nsid"))+"/"}},isPro:{defaultValue:!1,setter:function(e){return t.AttributeHelpers.coerceBoolean(e)}},proBadge:{defaultValue:"standard",setter:function(e){return t.AttributeHelpers.coerceString(e)}}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","attribute-helpers"]});YUI.add("flickr-groups-getTopContributors-fetcher",function(o,r){"use strict";function t(r,t){var e={id:r.id+"-"+t,nsid:r.id,dateJoined:r.dateJoined?o.moment(r.dateJoined.toString(),"X"):o.moment(),groupDiscussionCount:r.groupDiscussionCount,groupPhotoCount:r.groupPhotoCount,pathAlias:r.pathAlias,rank:r.rank,realname:r.realname,username:r.username,isPro:r.isPro,proBadge:r.proBadge,buddyicon:r.iconurls};return r.latestPhoto&&(e.latestPhotoId=r.latestPhoto.id,e.latestPhotoTitle=r.latestPhoto.name),e}o.namespace("ModelFetchers")["flickr-groups-getTopContributors"]={run:function(t,e){var i=this;return o.Promise.all([e.callAPI("flickr.groups.getTopContributors",this._processParams(t),!0),e.getModelRegistry("group-top-contributors-models"),e.getModelRegistry("group-contributor-models")]).then(function(o){return i._processResponse(o,t)},o.FetcherErrorLogger(r))},_processParams:function(o){return{group_id:o.id,type:"all",extras:"include_viewer,is_pro,icon_urls"}},_processResponse:function(o,r){var e,i,s,n=o[0],u=o[1],a=o[2];return i={photoContributors:[],discussionContributors:[],id:r.id},n&&n.contributors&&[{k:"photos",v:"photoContributors"},{k:"discussions",v:"discussionContributors"}].forEach(function(o){n.contributors[o.k]&&(e=n.contributors[o.k]).contributor&&e.contributor.forEach(function(e){s=t(e,r.id),i[o.v].push(a.addOrUpdate(s))})}),n&&n.viewer&&0!==n.viewer.length?(s=t(n.viewer,r.id),i.viewer=a.addOrUpdate(s)):i.viewer=null,u.addOrUpdate(i),u.proxy(i.id)}}},"@VERSION@",{requires:["flickr-promise","api-helper","moment","url-helper"],optional:["group-top-contributors-models","group-contributor-models"]});YUI.add("group-top-contributors-models",function(t){function r(t){r.superclass.constructor.call(this,t)}t.Models[this.name]=r,t.extend(r,t.FlickrModelRegistry,{name:this.name,remote:{read:function(r){var o=this;return t.ModelFetchers["flickr-groups-getTopContributors"].run(r,this.appContext).then(function(t){return o})}},attributes:{viewer:{isModel:!0,defaultValue:null},contributors:{isCollection:!0},photoContributors:{isCollection:!0},discussionContributors:{isCollection:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getTopContributors-fetcher","attribute-helpers"]});YUI.add("group-pool-models",function(t){function e(t){e.superclass.constructor.call(this,t)}t.Models[this.name]=e,t.extend(e,t.FlickrModelRegistry,{name:this.name,remote:{read:function(e){return t.ListFetchers["flickr-groups-pools-getPhotos"].run(e,this.appContext)},addPhoto:function(e,o){return e.registryName=this.name,t.ModelCreators["flickr-groups-pools-add"].run(e,o)},removePhoto:function(e,o){return e.registryName=this.name,t.ModelDeletors["flickr-groups-pools-remove"].run(e,o)},invitePhoto:function(e,o){return t.ModelCreators["flickr-groups-invite-photo-invite"].run(e,o)},cancelPhotoInvitation:function(e,o){return t.ModelDeletors["flickr-groups-invite-photo-cancel"].run(e,o)},acceptPhoto:function(e,o){return t.ModelUpdaters["flickr-groups-admin-acceptPhoto"].run(e,o)}},addPhotoLocal:function(t,e){return this.getValue(t,"photoPageList").unshift(e),this.getValue(t,"photoContextList").hasMaxBoundary()&&this.getValue(t,"photoContextList").appendToList(e),this},addPhotoRemote:function(t,e){return this.remote.addPhoto.call(this,{photoID:e,groupID:t},this.appContext)},removePhotoLocal:function(t,e){return this.getValue(t,"photoPageList").removeFromList(e.getValue("id")),this.getValue(t,"photoContextList").removeFromList(e.getValue("id")),this},removePhotoRemote:function(t,e){return this.remote.removePhoto.call(this,{photoID:e,groupID:t},this.appContext)},invitePhotoRemote:function(t,e){return this.remote.invitePhoto.call(this,{photoID:e,groupID:t},this.appContext)},cancelPhotoInvitationRemote:function(t,e){return this.remote.cancelPhotoInvitation.call(this,{photoID:e,groupID:t},this.appContext)},hasPhoto:function(t,e){return this.getValue(t,"photoPageList").getFromListByID(e)||this.getValue(t,"photoContextList").getFromListByID(e)},acceptPhotoRemote:function(t,e){return this.remote.acceptPhoto.call(this,{photoID:e,groupID:t},this.appContext)},attributes:{displayType:{readOnly:!0,defaultFn:function(){return"group"}},pathAlias:{validator:function(e,o){return t.AttributeHelpers.validateString(e)},setter:function(e){return t.AttributeHelpers.coerceString(e)},defaultFn:function(t){return t}},photoPageList:{isCollection:!0,pageFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getPhotos"]}},photoContextList:{isListProxy:!0,contextFetch:{listFetcher:t.ListFetchers["flickr-groups-pools-getContext"],listItemIdField:"photoId"}},group:{isModel:!0},urlSuffix:{readOnly:!0,derivedBy:["pathAlias"],defaultFn:function(t){var e=this.getValue(t,"pathAlias");return e||(e=t),"pool-"+e}},url:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("url")}},title:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("title")}},poolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},filteredPoolCount:{validator:function(e){return t.AttributeHelpers.validateInteger(e)},setter:function(e){return t.AttributeHelpers.coerceInteger(e)},defaultFn:function(t){return this.getValue(t,"group").getValue("poolCount")}},friendlyPoolCount:{readOnly:!0,derivedBy:["group"],defaultFn:function(t){return this.getValue(t,"group").getValue("friendlyPoolCount")}}}},{buildCompoundId:function(t,e){return t+"-"+e},extractGroupFromCompoundId:function(t){return t.split("-")[0]}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-pools-getContext-fetcher","flickr-groups-pools-getPhotos-fetcher","flickr-groups-pools-add-creator","flickr-groups-pools-remove-deletor","flickr-groups-invite-photo-invite-creator","flickr-groups-invite-photo-cancel-deletor","flickr-groups-admin-acceptPhoto-updater","attribute-helpers"],optional:["group-top-contributors-models"]});YUI.add("flickr-groups-create-creator",function(e,r){"use strict";e.namespace("ModelCreators")["flickr-groups-create"]={run:function(o,t){var i={user_id:o.userId,name:o.name,description:o.description,grouptype:o.privacyLevel,age_restriction:o.ageRestriction,safety_level:o.safetyLevel};return t.callAPI("flickr.groups.create",i).then(function(r){return"ok"===r.stat?t.getModel("group-pool-models",r.groupNsid):e.Promise.reject(r)},e.FetcherErrorLogger(r))}}},"@VERSION@",{requires:["flickr-promise","group-pool-models"],optional:[]});YUI.add("group-info-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ModelFetchers["flickr-groups-getInfo"].run(t,this.appContext)},join:function(t,r){return e.ModelCreators["flickr-groups-join"].run(t,r)},leave:function(t,r){return e.ModelDeletors["flickr-groups-leave"].run(t,r)},create:function(t,r){return e.ModelCreators["flickr-groups-create"].run(t,r)}},join:function(e){var t=this.getValue(e,"group");return t&&t.setValue("isMember",!0),this},leave:function(e){var t=this.getValue(e,"group");return t&&(t.setValue("isAdmin",!1),t.setValue("isModerator",!1),t.setValue("isMember",!1),this.setValue(e,"hasPendingRequestToJoin",!1)),this},attributes:{pathAlias:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},description:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},secureDescription:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},rules:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},roles:{},secureRules:{validator:function(t,r){return e.AttributeHelpers.validateString(t)},setter:function(t){return e.AttributeHelpers.coerceString(t)},defaultValue:""},hasPendingRequestToJoin:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},photoLimitOptOut:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},isInvited:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},discussionsLocked:{validator:function(t){return e.AttributeHelpers.validateBoolean(t)},setter:function(t){return e.AttributeHelpers.coerceBoolean(t)},defaultValue:!1},privacy:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultValue:1},restrictions:{},throttle:{},poolPreviewRowsVisibleCount:{validator:function(t){return e.AttributeHelpers.validateInteger(t)},setter:function(t){return e.AttributeHelpers.coerceInteger(t)},defaultFn:function(e){return 1}},coverPhotoAttribution:{},group:{isModel:!0}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-promise","flickr-groups-getInfo-fetcher","flickr-groups-join-creator","flickr-groups-leave-deletor","flickr-groups-create-creator","attribute-helpers","group-models"]});