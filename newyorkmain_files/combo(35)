YUI.add("hermes-lang-share-modal",function(e,o){e.Intl.add("hermes/share-modal","en-US",{SHARE_ON_BLOGGER:["Share on Blogger"],SHARE_PHOTO:["Share Photo"],SHARE_PHOTOS:["Share photos"],SHARE_VIDEO:["Share Video"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_BLOGGER:["please authorize Flickr to post on Blogger"],SHARE_ON_FACEBOOK:["Share on Facebook"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_FACEBOOK:["please authorize Flickr to post on Facebook"],SHARE_VIA_MAIL:["Share via mail"],SHARE_ON_TUMBLR:["Share on Tumblr"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TUMBLR:["please authorize Flickr to post on Tumblr"],PUBLISH_NOW:["Publish now"],ADD_TO_QUEUE:["Add to queue"],SAVE_AS_DRAFT:["Save as draft"],SHARE_ON_TWITTER:["Share on Twitter"],PLEASE_AUTHORIZE_FLICKR_TO_POST_ON_TWITTER:["please authorize Flickr to post on Twitter"],SHARE_PHOTOSTREAM:["Share photostream"],SHARE_ALBUM:["Share album"],SHARE_FAVORITES:["Share favorites"],AUTHORIZE_TO_SHARE:["You need to authorize Flickr to share photos on ","${service}"],CONNECT_TO_SERVICE:["Connect to ","${service}"],OK_TAKE_ME_TO_MY_SETTINGS:["OK, take me to my settings"],POST:["Post"],SHARE:["Share"],FRIENDS:["Friends"],FAMILY:["Family"],SCREEN_NAME_OR_EMAIL:["Screen name or email"],INCLUDE_A_MESSAGE:["Include a message"],SHARE_THIS_VIA:["Share this via..."],SHARE_PREFERENCES:["share preferences"],GRAB_THE_LINK:["Grab the link"],SHOW_SHORT_URL:["show short URL"],INCLUDE_CONTENT_MARKED_AS:["Include content marked as:"],PS_ITEMS_NOT_PUBLIC:["Some of the items in your photostream aren't public."],HERE_IS_PS_LINK:["Here's a link to this photostream. Just copy and paste!"],YOU_CAN_ADD_GUEST_PASS:['You can add a Guest Pass [<a class="guest-pass-link" title="',"${title}",'" data-action="follow" href="/help/sharing/#2184">?</a>] so that recipients can view them.'],ADD_A_GUEST_PASS:["Add a guest pass"],GUEST_PASS_COPY:["Guest Passes let you share your photos that aren't public. Anyone can see your public photos anytime, whether they're a Flickr member or not. But! If you want to share photos marked as friends, family or private, use a Guest Pass. If you're sharing photos from a set, you can create a Guest Pass that includes any of your photos marked as friends, family, or private. If you're sharing your entire photostream, you can create a Guest Pass that includes photos marked as friends or family (but not your private photos)."],VISIT_GUESTPASS_HISTORY:['You can visit your <a href="/invite/history/guests/" data-action="follow">Guest Pass history</a> at any time to expire the Guest Pass.'],SOMETHING_WRONG:["Something went wrong.<br>Please refresh your browser and try again."],ERROR:["Error"],OK:["OK"],SHARE_GROUP:["Share Group"],MESSAGE:["Message"],EMAIL:["Email"],SIGN_IN_TO_EMAIL:["You must be signed in to share a photo. Sign in and try again."],LINK_ACCOUNT:["Link Account"],ACCOUNT_SETTINGS:["Account Settings"],AUTHORIZE_FLICKR:["Authorize Flickr to use your account in the Account Settings page."],COPY_TO_CLIPBOARD:["Press Ctrl+C (Win) or Command+C (Mac) to copy this link when selected"],HTML_EMBED:["HTML Embed"],EMAIL_BODY_PHOTOS:["${username}"," shared ",{type:"plural",valueName:"count",options:{one:"${#} photos",other:"${#} photo"}}," with you!"],EMAIL_BODY_ALBUM:["${username}"," shared an album with you!"],EMAIL_BODY_PHOTOSTREAM:["${username}"," shared their photostream with you!"],SHARE_PHOTOS_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} photo to:",other:"Share ${#} photos to:"}}],SHARE_VIDEO_TO:[{type:"plural",valueName:"count",options:{one:"Share ${#} video to:",other:"Share ${#} videos to:"}}],SHARE_PHOTOSTREAM_TO:["Share photostream to:"],SHARE_ALBUM_TO:["Share album to:"],SHARE_GALLERY_TO:["Share gallery to:"],SHARE_FAVES_TO:["Share favorites to:"],SHARE_ALBUMS_TO:["Share albums to:"],SHARE_GROUP_TO:["Share group to:"],FACEBOOK:["Facebook"],TUMBLR:["Tumblr"],TWITTER:["Twitter"],PINTEREST:["Pinterest"],MAIL:["Mail"],EMBED:["HTML embed"],EMBED_SIMPLE:["Embed"],HTML:["HTML"],GRAB_LINK:["Grab link"],BBCODE:["BBCode"],VIA_FLICKR:["Via Flickr:"],SHARE_PUBLIC_ONLY:["Public photos only"],SHARE_FRIENDS:["Include photos marked Friends"],SHARE_FAMILY:["Include photos marked Family"],SHARE_FAMILY_AND_FRIENDS:["Include photos marked Family & Friends"],SHARE_FRIENDS_AND_FAMILY:["Include photos marked Friends & Family"],SHARE_PRIVATE:["All photos - public and private"],SHARING_DISABLED:["Sharing is disabled"],ON_FLICKR:["on Flickr"],PHOTO_PRIVATE_MESSAGE:['This photo is private. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FRIENDS_MESSAGE:['This photo is only visible to friends. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_MESSAGE:['This photo is only visible to family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_FAMILY_FRIENDS_MESSAGE:['This photo is only visible to friends & family. A guest pass [<a target="_blank" href="/help/sharing/">?</a>] will be added to allow recipients to view it.'],PHOTO_CAMERAROLL_MESSAGE:["All photos being shared will be viewable by the recipient(s) regardless of privacy level."],GUESTPASS_CREATION_FAILURE:["There was an error generating the share link.  Please try again."],CONTACT_SEARCH_ERROR:["There was an error when adding a recipient. Please try again."],FLICKR_SHARE_ERROR:["There was an error sharing on Flickr. Please try again."],FLICKR_SHARE_SUCCESS:["Your items have been shared!"],FLICKR_SHARE_SUCCESS_TITLE:["Success"],CLICK_GENERATE_LINK:["Click to generate a shareable link"],FLICKR_SHARE:["Share"],COPY_MAC:["Press Command+C to copy this link when selected"],COPY_PC:["Press Ctrl+C to copy this link when selected"],CANCEL_SHARE_BECAUSE_ERROR:[{type:"plural",valueName:"photoCount",options:{one:"This photo cannot be shared. Please try again later.",other:"These photos cannot be shared. Please try again later."}}],LINK_PRIVACY_REMINDER:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this selection will remain private. Only people you share this link with will be able to view it.",other:"The private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],PHOTO_PAGE_PRIVACY_WARNING:["This photo will remain private. Only people you share this link with will be able to view it."],CAMERAROLL_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"This photo will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this selection will remain private. Only people you share this link with will be able to view them."}}],ALBUM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in this album will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in this album will remain private. Only people you share this link with will be able to view them."}}],PHOTOSTREAM_PRIVACY_WARNING:[{type:"plural",valueName:"photoCount",options:{one:"The private photo in your photostream will remain private. Only people you share this link with will be able to view it.",other:"Any private photos in your photostream will remain private. Only people you share this link with will be able to view them."}}],CANCEL_SHARE_BECAUSE_RESTRICTED:["Sorry! You can't share restricted photos."],NO_SHAREABLE_ITEMS:["There are no items available to share."],CANT_SHARE_PRIVATE_GROUP_MESSAGE:['Private groups can only be viewed by the group\'s members. <a data-action="follow" href="',"${inviteURL}","\">Invite friends</a> to join the group if you'd like to share it."],CANT_SHARE_PRIVATE_GROUP_TITLE:["Share a Private Group"],EMBEDR_OPTION_HEADER:["Header"],EMBEDR_OPTION_FOOTER:["Footer"],EMBEDR_OPTION_TRUNCATE:["Truncate"],EMBEDR_OPTION_SLIDESHOW:["Slideshow"],EMBEDR_CHANGE_PRIVACY_WARNING:['You\'re trying to embed one of your private photos! If you still want to embed this photo, you can make it public by selecting "Public" from the privacy menu at the bottom this page.'],ALBUM_DOWNLOAD_ACCESS_YOU:[{type:"plural",valueName:"photoCount",options:{one:"Only you will be able to download this photo.",other:"Only you will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FF:[{type:"plural",valueName:"photoCount",options:{one:"Only your friends and family will be able to download this photo.",other:"Only your friends and family will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_FOLLOWING:[{type:"plural",valueName:"photoCount",options:{one:"Only people you follow will be able to download this photo.",other:"Only people you follow will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_MEMBERS:[{type:"plural",valueName:"photoCount",options:{one:"Only Flickr members will be able to download this photo.",other:"Only Flickr members will be able to download these photos."}}],ALBUM_DOWNLOAD_ACCESS_EVERYONE:[{type:"plural",valueName:"photoCount",options:{one:"Everyone will be able to download this photo.",other:"Everyone will be able to download these photos."}}],CHANGE_DOWNLOAD_PREF:["(<a href='","${url}","'>Change your download preferences</a>)"],EMBED_WITH_GUESTPASS:["Embed this photo with a guestpass"]})},"@VERSION@",{requires:["intl"]});YUI.add("fluid-share-view",function(e,r){var t=require("hermes-core/flog")(r),a={shareRedirectURL:e.url("/window_close.html"),css:{shareBtn:"fluid-share-button",networkClasses:{twitter:{canShare:!1,className:"twitter-link",serviceId:9},facebook:{canShare:!1,className:"facebook-link",serviceId:128},tumblr:{canShare:!1,className:"tumblr-link",serviceId:12},pinterest:{canShare:!1,className:"pinterest-link",serviceId:132},flickr:{canShare:!1,className:"flickr-link",serviceId:130}}}};a.networks={facebook:{clientId:e.config.flickr.facebook.client_id,shareUrl:"https://www.facebook.com/dialog/share?app_id="+e.config.flickr.facebook.client_id+"&display=popup&redirect_uri="+encodeURIComponent(a.shareRedirectURL)+"&href="},twitter:{shareUrl:"https://twitter.com/intent/tweet?text={{tweetText}}&url={{linkToShare}}",hashTags:"#flickr"},tumblr:{shareUrl:"https://www.tumblr.com/widgets/share/tool?caption={{tumblrCaption}}&tags={{tags}}&url={{linkToShare}}"},pinterest:{shareUrl:"https://pinterest.com/pin/create/bookmarklet/?media={{displayPhotoURL}}&url={{linkToShare}}&description={{description}}"},googlePlus:{shareUrl:"https://plus.google.com/share?url="},flickr:{apiCall:"flickr.sharing.post"}},e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.extraModalClasses=this.extraModalClasses||"","en-us"===this.appContext.lang.toLowerCase()?this.isEnglishLang=!0:this.isEnglishLang=!1,this.errorTitle=this.intlMessage({intlName:"common.OOPS"}),this.errorMessage=this.intlMessage({intlName:"share-modal.NO_SHAREABLE_ITEMS"}),this.removeOverlayOnClose=e.removeOverlayOnClose,this},loadState:function(){return e.Promise.resolve()},buildContainer:function(e){return e=e||{},this.setContainerWithTemplate("fluid-share",e),this},activate:function(){var r=this.get("container"),t="."+a.css.shareBtn,s=r.one(t);return!s||!this.isEnglish&&this.isDisabled||this.registerEventHandler(r.delegate(["click","keydown"],function(r){"click"!==r.type&&13!==r.keyCode||(r.preventDefault(),e.rapidTracker.beacon(this.subClassName,"shareButtonClick"),this.getItemCount().then(function(r){e.rapidTracker.beacon(this.subClassName,"shareButtonClickCount",{count:r})}.bind(this)),this.prepareModal(s))},t,this)),this},prepareModal:function(r){if(!this.shouldCancelModal())return this.getItemCount().then(function(t){return this.isDisabled?e.Promise.resolve(this.showErrorModal()):e.Promise.resolve(this.showModal(r,t,this.removeOverlayOnClose))}.bind(this)).catch(function(e){t.error({err:e})})},showModal:function(r,t,s){var i,n=this,o=this.getIsMine(),l=a.css.networkClasses,c=n.getTitleIntlKey(),h={intlName:"share-modal."+c};return"SHARE_PHOTOS_TO"!==c&&"SHARE_VIDEO_TO"!==c||(h.count=t),(i=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,noScroll:!0,hideModalOverlay:!1,maxHeight:!1,showFooter:!1,title:n.intlMessage(h),classList:"modal-restyle "+n.extraModalClasses,width:560,subview:new e.Views["fluid-share-panel-view"]({appContext:n.appContext,networkClasses:l,linkShareParams:this.prepareLinkShareParameters(),guestPassParams:this.getGuestPassParams(),emailShareParams:this.prepareFlickrShareParameters(),isMine:o,shareItemCount:t,signedOutSharingPerms:this.getSignedOutSharingPerms(),canVr:this.get("canVr")}),removeOverlayOnClose:s})).registerEventHandler(i.get("container").delegate(["click","keydown"],function(e){"click"!==e.type&&13!==e.keyCode||(e.preventDefault(),e.target.ancestor("."+l.facebook.className,!0)?n.preProcessShare(n.prepareFacebookShareParameters,n.shareToFacebook):e.target.ancestor("."+l.twitter.className,!0)?n.preProcessShare(n.prepareTwitterShareParameters,n.shareToTwitter):e.target.ancestor("."+l.tumblr.className,!0)?n.preProcessShare(n.prepareTumblrShareParameters,n.shareToTumblr):e.target.ancestor("."+l.pinterest.className,!0)&&n.preProcessShare(n.preparePinterestShareParameters,n.shareToPinterest))},".share-link.sharing-type-enabled")),i.on("share-by-email",function(r){var t=e.merge(n.prepareFlickrShareParameters(),r);n.shareToFlickr(i,t)}),i.on("done-sharing",function(r){i.close(),n.guestPassURLs={},e.rapidTracker.beacon(this.subClassName,"doneSharingClick")}),i.on("request-guestpass",function(e,r,t){n.requestGuestpass(i,r,t,!0)}),i.on("generate-link",function(){n.generateLink().then(function(e){i.fire("parentViewEvent","generated-link",e)})}),i.on("activated",function(){i.get("subview").cancel&&i.get("container").one(".title").setHTML(n.intlMessage({intlName:"common.OOPS"})),i.reposition()}),i.on("guestpass-required",function(){n.guestpassRequired=!0}),i.on("confirm-sign-in",function(){i.close();var r=new e.Views.FluidModal({appContext:n.appContext,title:n.intlMessage({intlName:"common.OOPS"}),message:n.intlMessage({intlName:"share-modal.SIGN_IN_TO_EMAIL"}),actionButtonLabel:n.intlMessage({intlName:"common.OK"}),classList:"sharing-sign-out-modal",showCancelButton:!0});r.on("actionClick",function(){e.StorageHelper.setItem("signedOutEmailSharing",new Date),e.SigninHelper.addPendingShare({shareType:"email"})}),setTimeout(function(){r.show()},10)}),i.on("close",function(){n.fire("sharePresentationClose"),n.guestPassURLs={},e.rapidTracker.beacon(n.name,"shareModalCancelClick")}),i.on("closeAll",function(){n.fire("sharePresentationClose"),i.close(),n.guestPassURLs={}}),i.show(),this.sharePresentation=i,i},showErrorModal:function(){var r=new e.Views.FluidModal({appContext:this.appContext,dismissOnOverlayClick:!0,showCancelButton:!1,noScroll:!0,hideModalOverlay:!1,showFooter:!0,title:this.errorTitle,message:this.errorMessage});return r.show(),r},prepareFacebookShareParameters:function(){return{url:"",count:1}},prepareTwitterShareParameters:function(){return{shortURL:"",url:"",title:"",count:1}},prepareTumblrShareParameters:function(){return{title:"",authorURL:"",ownerName:"",description:"",displayPhotoURL:"",url:"",count:1}},preparePinterestShareParameters:function(){return{title:"",description:"",displayPhotoURL:"",shortURL:"",url:"",count:1}},prepareGooglePlusShareParameters:function(){return{url:"",count:1}},prepareFlickrShareParameters:function(){return{modelName:"",modelId:"",title:"",url:"",count:1}},prepareLinkShareParameters:function(){return{sizes:{},url:"",title:"",author:"",authorURL:"",shortURL:"",supportsEmbedr:!1,supportsBBCode:!1,privacyWarningString:"",generateLink:!1}},getTitleIntlKey:function(){return"SHARE_PHOTOS_TO"},getItemCount:function(){return e.Promise.resolve(1)},getIsMine:function(){return!1},getGuestPassParams:function(){return{type:null,id:null,contentMarkedFriends:!0,contentMarkedFamily:!0,contentMarkedFriendFamily:!0,contentMarkedPublic:!0,canSharePrivate:!1,sharingEntirelyNotPublic:!1,multipleItems:!1,nonPublicWarning:null,shareToAll:!1,showGuestPassDropdown:!1,shareToSpecific:null}},getSignedOutSharingPerms:function(){return{facebook:{canShare:!0},twitter:{canShare:!0},tumblr:{canShare:!0},pinterest:{canShare:!0},flickr:{canShare:!1}}},shouldCancelModal:function(){return!1},shareToFacebook:function(r,s){if(!r.url)return t.error("Error sharing to Facebook.  Missing url.");var i,n,o,l,c,h=encodeURIComponent(e.url(r.url)),u=this.guestPassURLs;this.guestpassRequired&&u&&(n=u[100],o=u["010"],l=u[110],c=u[111],o&&(h=o),n&&(h=n),l&&(h=l),c&&(h=c)),i=a.networks.facebook.shareUrl+h,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"facebook",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i),this.trackShareCompletion(s)},shareToTwitter:function(r,s){if(void 0===r.url||null===r.url)return t.error("Error sharing to Twitter.  Missing url.");if(!r.title)return t.error("Error sharing to Twitter.  Missing title.");var i,n,o,l,c=r.title;n=""===r.url?"":encodeURIComponent(r.url),(l=c+" "+a.networks.twitter.hashTags).length+n.length>140&&(o=l.length+n.length-140,l=c.substring(0,c.length-(o+1))+"… "+a.networks.twitter.hashTags),i=a.networks.twitter.shareUrl.replace("{{tweetText}}",encodeURIComponent(l)).replace("{{linkToShare}}",n),s?s.location.replace(i):s=this.createSharePopup(i),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"twitter",count:r.count||1}),this.trackShareCompletion(s)},shareToTumblr:function(r,s){if(!r.title)return t.error("Error sharing to Tumblr.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Tumblr.  Missing displayPhotoURL.");var i,n,o,l,c,h=r.title,u=r.tags||"",p=r.description,d=e.URLHelper.addProtocolToURL(r.displayPhotoURL),g=r.isPhotoPage,m=a.networks.tumblr.shareUrl;g&&this.appContext.flipper.isFlipped("enable-tumblr-embed-share")||(m+="&shareSource=legacy&posttype=photo&content={{displayPhotoURL}}&clickthroughUrl={{linkToShare}}"),r.authorURL&&(n=e.url(r.authorURL)),r.ownerName&&(o=r.ownerName),l=0===r.url.indexOf("https://")?r.url:0===r.url.indexOf("//")?e.URLHelper.addProtocolToURL(r.url):e.url(r.url),i=this.templates("fluid-share-tumblr-post")({title:h,ownerURL:n,ownerName:o,description:p,linkToShare:l}),c=m.replace("{{displayPhotoURL}}",encodeURIComponent(d)).replace("{{tumblrCaption}}",encodeURIComponent(i)).replace(/{{linkToShare}}/g,encodeURIComponent(l)).replace("{{tags}}",encodeURIComponent(u)),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"tumblr",count:r.count||1}),s?s.location.replace(c):s=this.createSharePopup(c,!0)},shareToPinterest:function(r,s){if(!r.title)return t.error("Error sharing to Pinterest.  Missing title.");if(!r.displayPhotoURL)return t.error("Error sharing to Pinterest.  Missing displayPhotoURL.");if(!r.url)return t.error("Error sharing to Pinterest.  Missing url.");if(!r.shortURL)return t.error("Error sharing to Pinterest.  Missing shortURL.");var i,n,o,l=e.Handlebars.helpers.stripTags(r.description)||"",c=r.shortURL,h=r.title,u=e.URLHelper.addProtocolToURL(r.displayPhotoURL);n=encodeURIComponent(e.url(r.url)),o=""!==l.trim()?c+" | "+h+" | "+l:c+" | "+h,u=u.replace("https:","http:"),n=n.replace("https:","http:"),i=a.networks.pinterest.shareUrl.replace("{{displayPhotoURL}}",encodeURIComponent(u)).replace("{{description}}",encodeURIComponent(o)).replace("{{linkToShare}}",n),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"pinterest",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i,!0)},shareToGooglePlus:function(r,s){if(!r.url)return t.error("Error sharing to GooglePlus.  Missing url.");var i,n;n=encodeURIComponent(e.url(r.url)),i=a.networks.googlePlus.shareUrl+n,e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"googlePlus",count:r.count||1}),s?s.location.replace(i):s=this.createSharePopup(i)},shareToFlickr:function(r,s){if(!s.recipients)return t.error("Error sharing to Flickr.  Missing recipients.");if(!s.url)return t.error("Error sharing to Flickr.  Missing url.");if(!s.modelName)return t.error("Error sharing to Flickr.  Missing modelName.");if(!s.modelId)return t.error("Error sharing to Flickr.  Missing modelId.");var i,n,o=s.modelName,l=s.modelId,c=s.recipients,h=s.message||"",u=s.guestpassStr||"public",p={},d=[],g=[];encodeURIComponent(e.url(s.url)),"share_code"===o?p[o]=l:p[o+"_id"]=l,p.service_type_id="130",p.owner_id=this.appContext.getViewer().nsid,"public"!==u&&("friends"!==u&&"family_and_friends"!==u||(p.guestpass_friends="1"),"family"!==u&&"family_and_friends"!==u||(p.guestpass_family="1"),"private"===u&&(p.guestpass_private="1",p.guestpass_friends="1",p.guestpass_family="1"));for(i in c)(n=c[i]||{}).email?d.push(n.email):n.nsid&&g.push(n.nsid);p.to_flickr=g.join(","),p.to_email=d.join(","),p.message=e.flutil.escapeInput(h),e.rapidTracker.beacon(this.get("parentViewName"),"shareNetworkClick",{type:"flickr",count:s.count||1,flkcnt:g.length,emailcnt:d.length});var m=e.StorageHelper.getItem("signedOutEmailSharing");if(m){var f;try{(f=e.moment(m)).isValid()&&(new e.moment).diff(f,"hours")<2&&(e.rapidTracker.beacon(this.get("parentViewName"),"signedOutEmailShare",{count:s.count||1}),e.StorageHelper.remove("signedOutEmailSharing"))}catch(e){}}if(!a.networks)throw new Error("Missing sharing api configuration.");this.appContext.callAPI(a.networks.flickr.apiCall,p).then(function(){r&&r.fire("parentViewEvent","flickr-share-success")},function(e){r&&r.fire("parentViewEvent","flickr-share-error")})},generateLink:function(){var r=this;return this.onBeforeShare().then(function(e){return e},function(t){r.sharePresentation.fire("closeAll"),setTimeout(function(){new e.Views.FluidModal({appContext:r.appContext,title:r.intlMessage({intlName:"common.OOPS"}),message:r.intlMessage({intlName:"share-modal.CANCEL_SHARE_BECAUSE_ERROR",photoCount:r.getGuestPassParams.multipleItems?10:1}),actionButtonLabel:r.intlMessage({intlName:"common.OK"}),classList:"sharing-failure-modal",showCancelButton:!1}).show()},10)})},preProcessShare:function(e,r){var a=this;if(this.onBeforeShare){var s=this.createSharePopup("",!0);try{s.document.body.innerHTML=a.templates("fluid-share-loading-state")()}catch(e){18===e.code&&(s.close(),(s=this.createSharePopup("",!0)).document.body.innerHTML=a.templates("fluid-share-loading-state")())}this.onBeforeShare().then(function(i){var n;try{n=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,n,s)})}else{var i;try{i=e.call(a)}catch(e){t.error("Error getting share parameters",{err:e})}r.call(a,i)}},trackShareCompletion:function(r){var a=function(s){if(s.source===r)if(s.origin===e.url("/")&&"Window closed"===s.data)t.log("Closing Facebook window."),e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToFacebook"),e.config.win.removeEventListener("message",a,!1);else if(s.origin===e.url("/")&&0===s.data.indexOf("share failure"))t.error("Got Facebook error",{data:s.data}),e.config.win.removeEventListener("message",a,!1);else if("https://twitter.com"===s.origin&&"__ready__"!==s.data)try{t.log("Tracking share completion",{data:s.data}),"tweet"===JSON.parse(s.data).params[0]&&s.returnValue&&(e.rapidTracker.beacon(this.get("parentViewName"),"photoSharedToTwitter"),e.config.win.removeEventListener("message",a,!1))}catch(e){t.error("Error tracking share completion",{err:e})}};e.config.win.addEventListener("message",a,!1)},createSharePopup:function(r,t){var a={},s="",i="nativeShare"+(new Date).getTime();return a.width=t?950:640,a.height=480,a.top=(e.config.win.screen.height-a.height)/2,a.left=(e.config.win.screen.width-a.width)/2,e.Object.each(a,function(e,r){s+=r+"="+e+","}),s=s.slice(0,-1),e.config.win.open(r,i,s)},requestGuestpass:function(e,r,t,a){var s=this;this.guestPassURLs||(this.guestPassURLs={}),this.guestPassURLs[r]?e.fire("parentViewEvent","guestpass-created",r,this.guestPassURLs[r]):this.appContext.callAPI("flickr.sharing.createGuestpass",t).then(function(t){if(!t||!t.guestpass||!t.guestpass.url)throw new Error("No guestpass returned");s.guestPassURLs[r]=t.guestpass.url,e.fire("parentViewEvent","guestpass-created",r,s.guestPassURLs[r])},function(i){a?s.requestGuestpass(e,r,t):e.fire("parentViewEvent","guestpass-failed",i)})}},{ATTRS:{parentViewName:{value:""}}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-modal-view","hermes-template-fluid-share","hermes-template-fluid-share-tumblr-post","hermes-template-fluid-share-loading-state","fluid-share-panel-view","url","flutil","url-helper","signin-helper","handlebars-helpers"],optionalRequires:["fluid"],langBundles:["share-modal","common"]});YUI.add("fluid-share-photo-view",function(e,t){e.FlickrView.create(this.name,e.namespace("Views")["fluid-share-view"],[],{langBundles:this.details.langBundles,subClassName:t,initializer:function(e){return this.nsid=e.nsid,this.photoId=e.photoId,this.constructor.superclass.initializer.call(this,e)},loadState:function(){var t=this;return e.Promise.all([this.appContext.getModel("photo-models",this.photoId),this.appContext.getModel("photo-privacy-models",this.photoId),this.appContext.getModel("photo-engagement-models",this.photoId),this.appContext.getModel("photo-tags-models",this.photoId)]).then(function(e){return t.set("photoModel",e[0]),t.set("privacyModel",e[1]),t.set("engagementModel",e[2]),t.set("photoTagsModels",e[3]),t.set("tags",t.get("photoTagsModels").getValue("tags").toJSON()),t.get("photoModel").canVr().then(function(e){t.set("canVr",e)})})},buildContainer:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return this.get("photoModel").getValue("owner").id!==this.appContext.getViewer().nsid&&(e=e||!this.get("privacyModel").getValue("isPublic")),this.constructor.superclass.buildContainer.call(this,{extraShareButtonIconClassList:"share-photo-icon",showShareButtonLabel:!1,sharingDisabled:e,shareTooltip:this.intlMessage({intlName:"share-modal.SHARE_PHOTO"})}),this},prepareFacebookShareParameters:function(){return{url:this.get("photoModel").getValue("url")}},prepareTwitterShareParameters:function(){var t=this.get("photoModel");return{url:e.URLHelper.getShortURL(t.getValue("id")),title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"})}},prepareTumblrShareParameters:function(){var e=this.get("photoModel"),t=e.getValue("owner"),i=e.getLargestSize({excludeSizes:["o"]}).displayUrl,a=this.appContext.flipper.isFlipped("enable-flickr-embeds-on-tumblr");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),authorURL:t.getValue("url"),ownerName:t.getValue("displayname"),description:e.getValue("description"),displayPhotoURL:a?e.getValue("url"):i,url:e.getValue("url"),isPhotoPage:!0,tags:this.get("tags").map(function(e){return e.tagRaw}).join(",")}},preparePinterestShareParameters:function(){var t=this.get("photoModel");return{title:t.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),description:t.getValue("description"),displayPhotoURL:t.getLargestSize({excludeSizes:["o"]}).displayUrl,shortURL:e.URLHelper.getShortURL(t.getValue("id")),url:t.getValue("url"),count:1}},prepareFlickrShareParameters:function(){var e=this.get("photoModel");return{title:e.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),modelName:"photo",modelId:e.getValue("id"),url:e.getValue("url"),count:1}},prepareLinkShareParameters:function(){var t,i=this.get("photoModel"),a=this.get("privacyModel"),o=this.get("engagementModel").getValue("canShare");return t=!(!o||!this.get("photoModel").getValue("isVideo"))||o&&!this.get("photoModel").getValue("isVideo"),{url:this.appContext.flipper.isFlipped("enable-embedr-in-share")?e.config.win.location.pathname:i.getValue("url"),author:i.getValue("owner").getValue("displayname"),authorURL:i.getValue("owner").getValue("url"),shortURL:e.URLHelper.getShortURL(i.getValue("id")),supportsEmbedr:t,supportsBBCode:o,sizes:i.getValue("sizes"),title:i.getValue("title")||this.intlMessage({intlName:"common.UNTITLED"}),secret:i.getValue("secret"),privacyWarningString:this.intlMessage({intlName:"share-modal.PHOTO_PAGE_PRIVACY_WARNING"}),aspectRatio:i.getValue("aspectRatio"),isNonPublic:!a.getValue("isPublic")}},getTitleIntlKey:function(){return this.get("photoModel").getValue("isVideo")?"SHARE_VIDEO_TO":"SHARE_PHOTOS_TO"},getGuestPassParams:function(){var e,t=this.get("privacyModel"),i=t.getValue("isVisibleByFriends"),a=t.getValue("isVisibleByFamily"),o=!t.getValue("isPublic"),l=this.get("photoModel").getValue("isOwner");return a&&i?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_FRIENDS_MESSAGE"}):a?e=this.intlMessage({intlName:"share-modal.PHOTO_FAMILY_MESSAGE"}):i?e=this.intlMessage({intlName:"share-modal.PHOTO_FRIENDS_MESSAGE"}):o&&(e=this.intlMessage({intlName:"share-modal.PHOTO_PRIVATE_MESSAGE"})),{type:"photo",id:this.photoId,contentMarkedFriends:l&&i&&!a,contentMarkedFamily:l&&a&&!i,contentMarkedFriendFamily:l&&a&&i,contentMarkedPublic:!o&&!a&&!i,canSharePrivate:l&&o&&!a&&!i,showGuestPassDropdown:l&&o,multipleItems:!1,sharingEntirelyNotPublic:l&&o,nonPublicWarning:e}},getIsMine:function(){return this.get("photoModel").getValue("isOwner")},getSignedOutSharingPerms:function(){var e=this.get("engagementModel").getValue("canShare");return{facebook:{canShare:e},twitter:{canShare:e},tumblr:{canShare:e},pinterest:{canShare:e},flickr:{canShare:!1}}},onParentViewEvent:function(e,t){"enable-sharing"!==t[0]&&"disable-sharing"!==t[0]||this.buildContainer()},shouldCancelModal:function(){var e=2===this.get("photoModel").getValue("safetyLevel");return e&&this.buildContainer(),e},destructor:function(){this.fire("destroy")}})},"@VERSION@",{requires:["flickr-view","flickr-promise","fluid-share-view","url-helper","flutil"],langBundles:["models","share-modal"]});YUI.add("hermes-template-print-button",function(n,e){var a=n.Template.Handlebars.revive({1:function(n,e,a,t,l){var i;return" "+n.escapeExpression("function"==typeof(i=null!=(i=a.iconSize||(null!=e?e.iconSize:e))?i:a.helperMissing)?i.call(null!=e?e:{},{name:"iconSize",hash:{},data:l}):i)},3:function(n,e,a,t,l){return'\t\t<span class="label-beta new">\t\n\t\t\t'+n.escapeExpression((a.intlMessage||e&&e.intlMessage||a.helperMissing).call(null!=e?e:{},{name:"intlMessage",hash:{intlName:"common.NEW"},data:l}))+"\t\n\t\t</span>\t\n"},compiler:[7,">= 4.0.0"],main:function(n,e,a,t,l){var i,s=null!=e?e:{};return'<div class="print-button-container">\n\t<a role="button" class="print-button">\n\t\t<svg class="icon icon-cart_hollow'+(null!=(i=a.if.call(s,null!=e?e.iconSize:e,{name:"if",hash:{},fn:n.program(1,l,0),inverse:n.noop,data:l}))?i:"")+'"><use xlink:href="#icon-cart_hollow"></use></svg>\n\t</a>\n'+(null!=(i=a.if.call(s,null!=e?e.showNewLabel:e,{name:"if",hash:{},fn:n.program(3,l,0),inverse:n.noop,data:l}))?i:"")+"</div>"},useData:!0}),t={};n.Array.each([],function(e){var a=n.Template.get("hermes/"+e);a&&(t[e]=a)}),n.Template.register("hermes/print-button",function(e,l){return l=l||{},l.partials=l.partials?n.merge(t,l.partials):t,a(e,l)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-print-icon-tooltip",function(e,a){var n=e.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(e,a,n,t,s){var i=null!=a?a:{},l=n.helperMissing,r=e.escapeExpression;return'<div class="print-icon-tooltip-container">\n\t<header>\n\t\t<h3>'+r((n.intlMessage||a&&a.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"common.NEW"},data:s}))+'</h3>\n\t\t<svg class="close-x-button"><use xlink:href="#icon-close"></use></svg>\n\t</header>\n\t<div class="print-icon-description">\n\t\t<span>'+r((n.intlMessage||a&&a.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"prints.PRINT_TOOLTIP_TEXT_1"},data:s}))+'</span>\n\t\t<a href="/prints">'+r((n.intlMessage||a&&a.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"common.LEARN_MORE"},data:s}))+'</a>\n\t</div>\n\t<div class="print-icon-fine-print">'+r((n.intlMessage||a&&a.intlMessage||l).call(i,{name:"intlMessage",hash:{intlName:"prints.PRINT_TOOLTIP_TEXT_2"},data:s}))+"</div>\n</div>\n"},useData:!0}),t={};e.Array.each([],function(a){var n=e.Template.get("hermes/"+a);n&&(t[a]=n)}),e.Template.register("hermes/print-icon-tooltip",function(a,s){return s=s||{},s.partials=s.partials?e.merge(t,s.partials):t,n(a,s)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-prepare-print-modal",function(a,t){var e=a.Template.Handlebars.revive({compiler:[7,">= 4.0.0"],main:function(a,t,e,n,s){var l,i=null!=t?t:{},r=e.helperMissing,c=a.escapeExpression;return'<div class="prepare-print-modal-container loading">\n\t<div class="loading-container">\n\t\t<span class="preparing-text">'+c((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"prints.PREPARING_YOUR_PHOTO"},data:s}))+'</span>\n\t\t<span class="flickr-balls-container">\n'+(null!=(l=a.invokePartial(n["flickr-balls"],t,{name:"flickr-balls",data:s,indent:"\t\t\t",helpers:e,partials:n,decorators:a.decorators}))?l:"")+'\t\t</span>\n\t</div>\n\t<div class="error-container">\n\t\t<h1>'+c((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.OOPS"},data:s}))+'</h1>\n\t\t<p class="error-message"></p>\n\t\t<div class="button-container">\n\t\t\t<button class="mini alt cancel-button">'+c((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.CANCEL"},data:s}))+'</button>\n\t\t\t<button class="mini action retry-button">'+c((e.intlMessage||t&&t.intlMessage||r).call(i,{name:"intlMessage",hash:{intlName:"common.RETRY"},data:s}))+"</button>\n\t\t</div>\n\t</div>\n</div>"},usePartial:!0,useData:!0}),n={};a.Array.each(["flickr-balls"],function(t){var e=a.Template.get("hermes/"+t);e&&(n[t]=e)}),a.Template.register("hermes/prepare-print-modal",function(t,s){return s=s||{},s.partials=s.partials?a.merge(n,s.partials):n,e(t,s)})},"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-flickr-balls"]});YUI.add("prepare-print-modal-view",function(e,r){require("hermes-core/flog")(r);e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(e){},buildContainer:function(){this.setContainerWithTemplate("prepare-print-modal")},activate:function(){var e=this,r=this.get("container");this.contentContainer=r.one(".prepare-print-modal-container"),this.loadingContainer=r.one(".loading-container"),this.errorContainer=r.one(".error-container"),this.errorTextContainer=this.errorContainer.one(".error-message"),this.errorRetryButton=this.errorContainer.one("button.retry-button"),this.errorCancelButton=this.errorContainer.one("button.cancel-button"),this.registerEventHandler(this.errorRetryButton.on("click",function(){e.fire("retryClicked")})),this.registerEventHandler(this.errorCancelButton.on("click",function(){e.fire("closeClicked")}))},showError:function(e){this.contentContainer.removeClass("loading"),this.contentContainer.addClass("error"),e&&this.errorTextContainer.set("text",e)},showLoading:function(){this.contentContainer.addClass("loading"),this.contentContainer.removeClass("error")}})},"@VERSION@",{requires:["flickr-view","hermes-template-prepare-print-modal"],langBundles:["common","prints"]});YUI.add("hermes-lang-prints",function(o,e){o.Intl.add("hermes/prints","en-US",{PRINTS:["Prints"],SIGNUP_MODAL_TITLE:["Get amazing prints!"],SIGNUP_MODAL_MESSAGE:["Join Flickr to gain access to our amazing print labs for all of your photos."],GET_STARTED:["Get started"],PRINTS_AND_GIFTS:["Prints & Wall Art"],VIEW_CART:["View Cart"],VIEW_CART_WITH_COUNT:["View Cart (","${count}",")"],BUY_PRINTS:["Buy prints"],PHOTO_BOOKS_MENU_TEXT:["Photo Books"],CHOOSE_PHOTO_TO_GET_PRINTS:["Choose a photo to get prints and wall art."],BUY_PRINTS_MENU_TEXT:["Buy Prints"],CHOOSE_YOUR_PHOTO_TO_GET_PRINTS:["Choose one of your photos to get prints and wall art."],LEARN_MORE_THEN_FEEDBACK:['<a class="learn-link" href="',"${learnUrl}",'" target="_blank">Learn more</a> then <a class="feedback-link" href="',"${feedbackUrl}",'" target="_blank">tell us what you think!</a>'],GET_PRINTS:["Get prints"],THANKS_FOR_YOUR_ORDER:["Thanks for your order!"],YOUR_ORDER_NUMBER_IS:['Your order number is <a class="order-link" href="',"${orderUrl}",'" target="_blank">',"${orderNum}","</a>."],YOULL_RECEIVE_ORDER_EMAIL:['You’ll receive an email with your order details at <span class="email-span">',"${email}","</span>."],HAVE_QUESTIONS_LINE:['Have questions? Check out <a class="help-link" href="',"${helpUrl}",'" target="_blank">our Help Center</a>.'],WE_WELCOME_FEEDBACK_HERE:['We welcome <a class="feedback-link" href="',"${feedbackUrl}",'" target="_blank">your feedback here</a>.'],PRINT_TOOLTIP_TEXT:["You can now get prints and wall art of your own photos. (This is only available to you for your photos)"],PRINT_TOOLTIP_TEXT_1:["You can now get prints and wall art of your own photos."],PRINT_TOOLTIP_TEXT_2:["This service is only available to you for your photos."],GET_PRINTS_WALL_ART_TITLE:["Get prints and wall art of your photos"],GET_PRINTS_WALL_ART_DESCRIPTION:["Choose from metal, canvas, or paper prints in many sizes and styles."],SELECT_FROM_YOUR_PHOTOS:["Select from your photos"],ENGLISH_LANGUAGE_AHEAD:["English language ahead!"],ORDERING_IS_ENGLISH_ONLY:["Our ordering process is English-only at the moment. Please proceed if you’re comfortable reading English."],CONTINUE_IN_ENGLISH:["Continue in English"],PRINTS_AND_WALL_ART:["Prints & Wall Art"],GET_STUNNING_WALL_ART:["Get stunning wall art and high-quality prints of your photos"],CHOOSE_PHOTOS:["Choose photos"],METAL_PRINTS:["Metal prints"],METAL_PRINTS_DESCRIPTION:["Metal prints deliver unparalleled color and vibrance to produce a depth and clarity unlike any other photographic wall art. If you want a print as bold as your most epic photos, look no further than metal prints."],PAPER_PRINTS:["Paper prints"],PAPER_PRINTS_DESCRIPTION:["Paper prints are a time-honored way to show off and share your favorite photos. From stacks of 4x6s to frameable statement pieces, you'll be able to find the perfect size and paper finish for any  photo."],CANVAS_PRINTS:["Canvas prints"],CANVAS_PRINTS_DESCRIPTION:["Add a little class to your home, office, or whatever other space needs  a classic canvas print. With shapes and sizes perfect for wherever you want to hang your photos, your images will look outstanding."],WHO_CAN_PRINT_PHOTOS_QUESTION:["Who can print my photos?"],WHO_CAN_PRINT_PHOTOS_ANSWER:["Only you can print your photos through Flickr. Visitors to your account will not see the option to buy prints of your photos."],WHO_MAKES_PRINTS_QUESTION:["Who makes the prints and wall art?"],WHO_MAKES_PRINTS_ANSWER:["Flickr Prints benefit from years of experience that SmugMug has in printing beautiful imagery. Depending on your location, your prints will come from Bay Photo, White House Custom Colour, or Loxley Colour. All the labs we use have excellent color reproduction and fantastic reputations."],HOW_LONG_SHIP_QUESTION:["How long does shipping take?"],HOW_LONG_SHIP_ANSWER:["We ship all over the world, including more than 160 countries. No matter where you are, we'll get your prints to you as fast as we can. Expedited shipping is available to get your prints even faster."],WHAT_IF_WRONG_ORDER_QUESTION:["What if something is wrong with my order?"],WHAT_IF_WRONG_ORDER_ANSWER:['If you\'re ever unhappy with your prints or wall art, Flickr will make it right. Simply send us an email within 30 days of receiving your order and we\'ll help you out. If you have any issues, <a class="support-link" href="',"${supportUrl}",'" target="_blank">reach out to our Support Heroes</a>.'],WHERE_PHOTO_BOOK_QUESTION:["Where can I make a photo book?"],WHERE_PHOTO_BOOK_ANSWER:["We partner with Blurb and Chatbooks for both hard-cover and soft-cover photo books. Your Flickr photo stream and albums are seamlessly integrated into the book-making process. Check out photo books."],WHERE_PHOTO_BOOK_ANSWER_WITH_LINKS:['We partner with <a class="blurb-link" href="',"${blurbUrl}",'" target="_blank">Blurb</a> and <a class="chatbooks-link" href="',"${chatbooksUrl}",'" target="_blank">Chatbooks</a> for both hard-cover and soft-cover photo books. Your Flickr photo stream and albums are seamlessly integrated into the book-making process. <a class="photo-books-link" href="',"${photoBooksUrl}",'" target="_blank">Check out photo books.</a>'],MORE_QUESTIONS_QUESTION:["More questions?"],MORE_QUESTIONS_ANSWER:['Please visit the <a class="help-link" href="',"${helpUrl}",'" target="_blank">Flickr Help Center</a> for more information or to connect with a Support Hero.'],PREPARING_YOUR_PHOTO:["Preparing your photo..."],SOMETHING_WRONG_PREPARING_PRINT:["Something went wrong while preparing your photo for prints."],MID_PAGE_PHOTO_ATTRIBUTION:["Photo by ","${photoOwner}","."],UNSUPPORTED_FILE_TYPE_PLEASE_JPG:["This is an unsupported file type. Please use JPG files for prints."],PRINT_PHOTOS_WITH_EASE:["Print your favorite photos from the best labs with ease."]})},"@VERSION@",{requires:["intl"]});