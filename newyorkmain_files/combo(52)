YUI.add("flickr-photos-search-fetcher",function(e,o){"use strict";var t=require("superagent"),r=require("hermes-core/flog")(o);e.namespace("ListFetchers")["flickr-photos-search"]={run:function(s,a){var p,i=this,l=s.emptyQuery?{}:this._processParams(e.merge({lang:a.lang||e.config.lang},s),a);if(l||(s.emptyQuery=!0),s.useV2API){var n=s.apiParams.tags||s.apiParams.text,h={orderBy:"interestingness",query:n,pageNumber:s.page-1>=0?s.page-1:0,pageSize:s.perPage,format:"json",nojsoncallback:1};s.minDateTaken&&s.maxDateTaken&&(s.apiParams.tags||s.apiParams.text)&&(h.query=e.SearchHelper.normalizeTag(n),h.context="tag:"+e.SearchHelper.normalizeTag(n)+" dateUploaded:["+s.minDateTaken+" TO "+s.maxDateTaken+"]"),p=[t.get("https://api.flickr.com/v2/media/search").use(require("hermes-core/req-id")).query(h).catch(function(e){return r.warn("API V2 Search returned a non valid response",{err:e}),{body:[],headers:{"x-total-count":0}}})]}else p=[s.emptyQuery?e.Promise.resolve({photos:{photo:[]}}):a.callAPI("flickr.photos.search",l)];return p=s.getPhotoLiteModels?p.concat([a.getModelRegistry("search-photos-lite-models"),a.getModelRegistry("photo-lite-models")]):p.concat([a.getModelRegistry("search-photos-models"),a.getModelRegistry("photo-models"),a.getModelRegistry("person-models"),a.getModelRegistry("photo-engagement-models"),a.getModelRegistry("photo-stats-models"),a.getModelRegistry("photo-geo-models")]),e.Promise.all(p).then(function(e){return i._processResponse(e,s)},e.FetcherErrorLogger(o))},_processParams:function(o,t){var r,s=e.merge(e.SearchHelper.UNIFIED_DEFAULT_PARAMS,{extras:e.APIHelper.request[o.getPhotoLiteModels?"getRebootPhotoLiteExtras":"getRebootPhotoExtras"](),per_page:o.perPage||50,page:o.page||"1",lang:o.lang});return o.fetchGeo&&(s.extras+=",geo"),o.additionalExtras&&(s.extras+=","+o.additionalExtras.join(",")),r=e.merge(s,o.apiParams||{}),o.privacyFilter&&(r.privacy_filter=o.privacyFilter),YUI.Env.isServer&&e.SearchHelper.unescapeParameters(r),e.SearchHelper.isParameterlessSearch(r)?null:r},_processResponse:function(o,t){var r,s,a,p,i,l,n=o[0],h=o[1],d=o[2],g={id:t.id||e.SearchUrl.EMPTY_SEARCH_ID,apiParams:{},emptyQuery:!!t.emptyQuery,photos:[]};if(t.id&&t.id!==e.SearchUrl.EMPTY_SEARCH_ID&&(g.apiParams=e.QueryString.parse(t.id)),!t.id)throw new ReferenceError("No `id` provided by request.");if(!(t.useV2API||n.photos&&n.photos.photo)){var c=new Error("No `photos.photo` property returned by search API v1.");throw c.fatal=!0,c}var u=t.useV2API?n.body:n.photos.photo;return t.getPhotoLiteModels?a=u.map(function(o){return i=e.APIHelper.response.parsePhotoLite(o),d.addOrUpdate(i)}):(a=e.APIHelper.response.parsePhotos({photos:n.photos.photo,photoModelRegistry:d,personModelRegistry:o[3],photoEngagementModelRegistry:o[4],photoStatsModelRegistry:o[5]}),t.fetchGeo&&(r=o[6],n.photos.photo.forEach(function(e){p=void 0!==e.latitude?{id:e.id,hasGeo:!0,latitude:e.latitude,longitude:e.longitude}:{id:e.id,hasGeo:!1},r.addOrUpdate(p)}))),g.photos={perPage:t.useV2API?t.perPage:n.photos.perpage,page:t.useV2API?t.page:n.photos.page,pageContent:a,totalItems:t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),totalPages:t.useV2API?parseInt(n.headers["x-total-count"]/t.perPage,10):n.photos.pages/t.perPage},!t.useV2API&&n.photos.maxAllowedResults&&(g.photos.totalItems=Math.min(n.photos.maxAllowedResults,parseInt(n.photos.total,10))),!t.useV2API&&n.photos.maxAllowedPages&&(g.photos.totalPages=Math.min(n.photos.maxAllowedPages,n.photos.pages)),g.totalItems=t.useV2API?n.headers["x-total-count"]:parseInt(n.photos.total,10),h.exists(g.id)?(s=h.getValue(g.id,"photos").getList(),l=s.filter(function(e){return!!e}).reduce(function(e,o){return e[o.id]=!0,e},{}),g.photos.pageContent=g.photos.pageContent.filter(function(e){return!l[e.id]}),1===g.photos.page&&(g.photos.forceAppend=!0),h.addOrUpdate(g)):h.add(g),a}}},"@VERSION@",{requires:["flickr-promise","search-helper","search-url","api-helper","querystring-parse-simple"],optional:["search-photos-models","search-photos-lite-models","photo-models","photo-lite-models","person-models","photo-engagement-models","photo-stats-models","photo-geo-models"],optionalRequires:["superagent"]});YUI.add("search-photos-models",function(e){function t(e){t.superclass.constructor.call(this,e)}e.Models[this.name]=t,e.extend(t,e.FlickrModelRegistry,{name:this.name,remote:{read:function(t){return e.ListFetchers["flickr-photos-search"].run(t,this.appContext)}},attributes:{photos:{isCollection:!0,pageFetch:{listFetcher:e.ListFetchers["flickr-photos-search"],listItemIdField:"photoId"}},totalItems:{setter:function(t){return(t=e.AttributeHelpers.coerceInteger(t))<0&&(t=0),t},defaultValue:0},apiParams:{writeOnce:"initOnly"},emptyQuery:{defaultValue:!1}}})},"@VERSION@",{requires:["flickr-model-registry","flickr-photos-search-fetcher"]});YUI.add("photo-selector-limited-rows-photolist-view",function(e){e.namespace("Views")[this.name]=e.Base.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return t.photolistViewClasses&&(t.additionalViewClasses=t.photolistViewClasses),t.photoListConfig=e.merge(t.primaryPhotoListConfig),this.searchUrl=t.searchUrl,this.listId=t.listId,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this},subviewConfig:{"photo-list-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},loadState:function(){return this.appContext.getModel("search-photos-lite-models",this.searchUrl.getId(),{}).then(function(e){this.searchModel=e,e.getValue("totalItems")<=0&&this.set("emptySearch",!0)}.bind(this))},buildContainer:function(){var e="search.YOUR_PHOTOS";return"contacts"===this.listId?e="search.FROM_YOUR_CONTACTS":"everyone"===this.listId&&(e="search.EVERYONES_PHOTOS"),this.setContainerWithTemplate("search-photos-single-row",{emptySearch:this.get("emptySearch"),total:this.searchModel.getValue("totalItems"),singleResult:1===this.searchModel.getValue("totalItems"),viewAll:"#"+this.listId,"photo-list-view":this.subviews["photo-list-view"].get("container"),title:this.intlMessage({intlName:e})}),this},activate:function(){return this.registerEventHandler(this.get("container").on("click",this.handleClick.bind(this))),this},handleClick:function(e){e.halt();var t,i=e.target;i.hasClass("view-more-link")&&(t=i.getDOMNode().href.split("#")[1],this.fire("subviewViewEvent","viewEntireSearchList",{list:t,searchUrl:this.searchUrl}))}},{ATTRS:{emptySearch:{value:!1}}})},"@VERSION@",{requires:["flickr-view","photo-list-view","hermes-template-search-photos-single-row","search-photos-lite-models"],langBundles:["common","search"]});YUI.add("hermes-template-photo-selector-photo-list-photo-interaction",function(e,a){var t=e.Template.Handlebars.revive({1:function(e,a,t,l,n){var s,o=e.escapeExpression;return'<a href="'+o(e.lambda(null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.url:s,a))+'" class="attribution">'+o((t.intlMessage||a&&a.intlMessage||t.helperMissing).call(null!=a?a:{},{name:"intlMessage",hash:{user:null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.displayname:s,intlName:"common.BY_USER"},data:n}))+"</a>"},compiler:[7,">= 4.0.0"],main:function(e,a,t,l,n){var s,o,i=null!=a?a:{},r=e.escapeExpression;return'<div class="photo-list-photo-interaction">\n\t<div class="square"></div>\n\t<div class="interaction-bar">\n\t\t<div class="text">\n\t\t\t<a href="'+r("function"==typeof(o=null!=(o=t.photoPageUrl||(null!=a?a.photoPageUrl:a))?o:t.helperMissing)?o.call(i,{name:"photoPageUrl",hash:{},data:n}):o)+'" class="title">'+r(e.lambda(null!=(s=null!=a?a.photo:a)?s.title:s,a))+"</a>\n\t\t\t"+(null!=(s=t.if.call(i,null!=(s=null!=(s=null!=a?a.photo:a)?s.owner:s)?s.displayname:s,{name:"if",hash:{},fn:e.program(1,n,0),inverse:e.noop,data:n}))?s:"")+'\n\t\t</div>\n\t</div>\n</div>\n<div class="disabled-overlay"></div>\n'},useData:!0}),l={};e.Array.each([],function(a){var t=e.Template.get("hermes/"+a);t&&(l[a]=t)}),e.Template.register("hermes/photo-selector-photo-list-photo-interaction",function(a,n){return n=n||{},n.partials=n.partials?e.merge(l,n.partials):l,t(a,n)})},"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("photo-selector-photolist-interaction-view",function(t){var e=require("hermes-core/type-validator");t.namespace("Views")[this.name]=t.Base.create(this.name,t.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.hasMultiSelect=t.primaryPhotoListConfig&&t.primaryPhotoListConfig.hasMultiSelect,this.multiSelectLimit=void 0===t.primaryPhotoListConfig.multiSelectLimit?1:t.primaryPhotoListConfig.multiSelectLimit,this.listType=t.primaryPhotoListConfig.type,this.galleryId=t.primaryPhotoListConfig.galleryId,this.isDisabled=!1,this.isDisabledSelected=!1,this},loadState:function(){var e=this,i=[];return"galleryFaves"===this.listType&&this.galleryId&&(i.push(this.appContext.getModelRegistry("gallery-photo-association-models").then(function(t){t.exists(e.galleryId+"-"+e.get("id"))&&(e.isDisabled=!0,e.isDisabledSelected=!0)})),i.push(this.appContext.getModel("gallery-faves-models",this.appContext.getViewer().nsid+"-"+e.galleryId).then(function(t){var i=t.getValue("nonGalleryAddablePhotos").getList(),s=!1;i&&(s=i.some(function(t){return t.id===e.get("model").id})),s&&(e.isDisabled=!0)}))),i.push(this.appContext.getModel("profile-selected-photos-models",this.appContext.getViewer().nsid).then(function(t){t.getValue("photos").getFromListByID(this.get("model").getValue("id"))&&this.set("isActive",!0)}.bind(this))),t.Promise.all(i)},buildContainer:function(){var t=this.get("model");return this.setContainerWithTemplate("photo-selector-photo-list-photo-interaction",{photo:t.toJSON(),photoPageUrl:this.get("photoPageUrl")}),this},activate:function(){var e,i,s=this.get("container"),o=s.one(".disabled-overlay");return this.galleryId&&(e=this.intlMessage({intlName:"gallery.PHOTO_CANT_ADD_TO_GALLERY",mediaType:this.get("model").getValue("mediaType")}),i=this.intlMessage({intlName:"gallery.PHOTO_ALREADY_IN_GALLERY",mediaType:this.get("model").getValue("mediaType")})),this.registerEventHandler(s.on("click",this.selectPhoto.bind(this))),this.hasMultiSelect||this.registerEventHandler(t.on("photoSelector:subviewEvent",this.handleOtherPhotoSelected,this)),this.get("isActive")?this.get("isActive")&&s.addClass("active"):s.removeClass("active"),this.isDisabled&&(s.addClass("disabled"),o.setAttribute("title",e)),this.isDisabledSelected&&(s.addClass("disabled-selected"),o.setAttribute("title",i)),this},selectPhoto:function(e){if(e.halt(),!this.isDisabled)if(this.get("isActive")&&this.hasMultiSelect)this.set("isActive",!1),this.get("container").removeClass("active"),t.fire("photoSelector:subviewEvent",{eventName:"unselectPhotoFromPhotoList",id:this.get("id")});else{if(this.hasMultiSelect)return this.appContext.getModel("profile-selected-photos-models",this.appContext.getViewer().nsid).then(function(e){e.getValue("photos").size()+1<=this.multiSelectLimit&&(this.set("isActive",!0),this.get("container").addClass("active"),t.fire("photoSelector:subviewEvent",{eventName:"selectPhotoFromPhotoList",id:this.get("id")}))}.bind(this));this.set("isActive",!0),this.get("container").addClass("active"),t.fire("photoSelector:subviewEvent",{eventName:"selectPhotoFromPhotoList",id:this.get("id")})}},handleOtherPhotoSelected:function(t){if("selectPhotoFromPhotoList"===t.eventName&&this.get("isActive")){if(t.id===this.get("id"))return;this.set("isActive",!1),this.get("container")._node&&this.get("container").removeClass("active")}}},{ATTRS:{id:{writeOnce:"initOnly",validator:function(t,i){return e.photoId(t)}},model:{writeOnce:"initOnly"},photoPageUrl:{writeOnce:"initOnly"}}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-selector-photo-list-photo-interaction","attribute-helpers"],optionalRequires:["fluid"],langBundles:["common","gallery"]});YUI.add("hermes-lang-gallery",function(e,o){e.Intl.add("hermes/gallery","en-US",{VIEW_YOUR_GALLERIES:["View your galleries"],GALLERIES_WITH_YOUR_ITEMS:["Galleries with your items"],GALLERY_CURATED_BY:['a gallery curated by <a href="',"${ownerUrl}",'">',"${ownerName}","</a>"],GALLERY_CURATED_BY_YOU:['a gallery curated by <a href="',"${ownerUrl}",'">YOU!</a>'],PRIVATE_GALLERY_CURATED_BY:['a private gallery curated by <a href="',"${ownerUrl}",'">',"${ownerName}","</a>"],YOU_ATTRIBUTION:["YOU!"],DESCRIPTION_READ_MORE:["read more"],DESCRIPTION_READ_LESS:["read less"],BACK_TO_GALLERIES_LIST:["Back to galleries list"],ADD_COMMENT:["Add comment"],EDIT_GALLERY:["Edit gallery"],ADD_A_TITLE:["Add a title"],ADD_A_DESCRIPTION:["Add a description"],COVER_PHOTO:["Cover photo"],CHOOSE_A_COVER_PHOTO:["Choose a cover photo"],CHANGE_COVER_PHOTO:["Change cover photo"],PRIVATE_GALLERY:["Private gallery"],DELETE_GALLERY:["Delete gallery"],GALLERY_CONFIRM_DELETE_MESSAGE:["Are you sure you want to delete this gallery?"],MAKE_GALLERY_PUBLIC:["Make this gallery public?"],GALLERY_PUBLIC_EXPLANATION:["This gallery will be visible to others, and notifications will be sent when you add photos."],LARGE_VIEW_LAYOUT_TITLE:["Large view"],REORDER_PHOTOS_LAYOUT_TITLE:["Reorder photos"],GALLERY_PHOTO_REMOVE_MESSAGE:["This photo will be removed from the gallery."],GALLERY_PHOTO_REMOVE_TITLE:["Remove this photo from the gallery?"],PHOTO_REMOVED:[{type:"select",valueName:"mediaType",options:{photo:["Photo"],video:["Video"],other:["Photo"]}}," removed"],REMOVE_FROM_GALLERY:["Remove from gallery"],GALLERY_REMARK_OWNER_SAYS:["${ownerName}"," says:"],GALLERY_REMARK_WHY:["Why did you choose this ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}},"?"],IN_THIS_GALLERY:["In this gallery:"],AND_COUNT_MORE:["and ","${count}"," more"],NEW_GALLERY:["New Gallery"],NOTHING_HERE_YET:["Nothing here yet."],NOTHING_HERE_YET_DETAILS:["You can save a photo or video to a gallery from its detail page, or choose from your faves here."],ADD_PHOTOS_AND_VIDEOS:["Add photos and videos"],REMOVING:["Removing..."],ARE_YOU_SURE_REMOVE_PHOTO:["Are you sure you want to remove this ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}},"?"],ARE_YOU_SURE_REMOVE_VIDEO:["Are you sure you want to remove this video?"],GALLERY_ADD:["Add"],GALLERY_CHOOSE_PHOTOS_LIMIT:[{type:"plural",valueName:"limit",options:{one:"Choose up to ${#} more photo to add to your gallery.",other:"Choose up to ${#} more photos to add to your gallery."}}],GALLERY_FULL_CANT_ADD:["Your gallery is full! To add new photos, you need to remove some first."],GALLERY_EDIT_REMARK_TOOLTIP:["Edit remark"],GALLERY_VIEW_REMARK_TOOLTIP:["View remark"],GALLERY_FEATURED_BANNER_MESSAGE:['You’re looking at the new Flickr galleries. <a href="',"${learnUrl}",'" class="learn-more-link">Learn more</a>. <a href="',"${feedbackUrl}",'" class="feedback-link">Share feedback</a>.'],GALLERY_FEATURED_TITLE:["New Galleries"],GALLERY_FEATURED_DESCRIPTION:["Now with more features and up to 500 photos."],GALLERY_FEATURED_LEARN_MORE:["Learn More"],GALLERY_FEATURED_SUBMIT_FEEDBACK:["Submit Feedback"],PHOTO_CANT_ADD_TO_GALLERY:["This ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}," can’t be added to the gallery."],PHOTO_ALREADY_IN_GALLERY:["This ",{type:"select",valueName:"mediaType",options:{photo:["photo"],video:["video"],other:["photo"]}}," is already in the gallery."],USER_HASNT_CREATED_GALLERIES:["${ownerName}"," hasn’t created any galleries yet."],GALLERIES_COUNT:[{type:"plural",valueName:"count",options:{one:["${countString}"," gallery"],other:["${countString}"," galleries"]}}]})},"@VERSION@",{requires:["intl"]});